    <p-toast />
    <p-confirmDialog />
    
    <div class="page-header">
      <h2>Assinaturas</h2>
      <p-button
        label="Nova Assinatura"
        icon="pi pi-plus"
        (onClick)="abrirModalNovaAssinatura()"
      />
    </div>

    <div class="search-container">
      <div class="search-wrapper">
        <input
          type="text"
          pInputText
          placeholder="Pesquisar por paciente, serviço, valor..."
          [ngModel]="termoPesquisa()"
          (ngModelChange)="termoPesquisa.set($event)"
          class="search-input"
        />
        @if (termoPesquisa()) {
          <p-button
            icon="pi pi-times"
            (onClick)="limparPesquisa()"
            styleClass="p-button-text p-button-rounded p-button-plain clear-button"
            pTooltip="Limpar pesquisa"
            [rounded]="true"
          />
        }
      </div>
      @if (termoPesquisa() && assinaturasFiltradas().length > 0) {
        <div class="search-results-info">
          <i class="pi pi-info-circle"></i>
          <span>{{ assinaturasFiltradas().length }} assinatura(s) encontrada(s)</span>
        </div>
      }
      @if (termoPesquisa() && assinaturasFiltradas().length === 0) {
        <div class="search-no-results">
          <i class="pi pi-search"></i>
          <span>Nenhuma assinatura encontrada com o termo "{{ termoPesquisa() }}"</span>
        </div>
      }
    </div>

    <p-table
      [value]="assinaturasFiltradas()"
      [paginator]="true"
      [rows]="10"
      [loading]="carregando()"
      [tableStyle]="{ 'min-width': '50rem' }"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Paciente</th>
          <th>Serviço</th>
          <th>Valor Mensal</th>
          <th>Dia Vencimento</th>
          <th>Data Início</th>
          <th>Status</th>
          <th>Ações</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-assinatura>
        <tr>
          <td>{{ assinatura.pacienteNome }}</td>
          <td>{{ assinatura.servicoNome }}</td>
          <td>{{ assinatura.valorMensal | currency: 'BRL' }}</td>
          <td>{{ assinatura.diaVencimento }}</td>
          <td>{{ assinatura.dataInicio | date: 'dd/MM/yyyy' }}</td>
          <td>
            <p-tag
              [value]="assinatura.ativo ? 'Ativa' : 'Inativa'"
              [severity]="assinatura.ativo ? 'success' : 'danger'"
            />
          </td>
          <td>
            @if (assinatura.ativo) {
              <p-button
                icon="pi pi-times"
                label="Cancelar"
                severity="danger"
                (onClick)="confirmarCancelamento(assinatura)"
                styleClass="p-button-sm"
              />
            }
          </td>
        </tr>
      </ng-template>
    </p-table>

    <!-- Modal Nova Assinatura -->
    <p-dialog
      [(visible)]="_modalVisivel"
      header="Nova Assinatura"
      [modal]="true"
      [style]="{ width: '90vw', maxWidth: '800px', maxHeight: '90vh' }"
      [draggable]="false"
      [resizable]="false"
      (onHide)="fecharModal()"
    >
      <div class="form-group">
        <label>Paciente(s) *</label>
        <p-multiSelect
          [(ngModel)]="pacienteIdsSelecionados"
          [options]="pacientes()"
          optionLabel="nome"
          optionValue="id"
          placeholder="Selecione um ou mais pacientes"
          styleClass="full-width"
          [appendTo]="'body'"
        />
      </div>

      <div class="form-group">
        <label>Serviço *</label>
        <p-select
          [(ngModel)]="novaAssinatura.servicoId"
          [options]="servicos()"
          optionLabel="nome"
          optionValue="id"
          placeholder="Selecione o serviço"
          styleClass="full-width"
          [appendTo]="'body'"
        />
      </div>

      <div class="form-group">
        <label>Valor Mensal *</label>
        <p-inputNumber
          [(ngModel)]="novaAssinatura.valorMensal"
          mode="currency"
          currency="BRL"
          locale="pt-BR"
          styleClass="full-width"
        />
      </div>

      <div class="form-group">
        <label>Dia de Vencimento *</label>
        <p-inputNumber
          [(ngModel)]="novaAssinatura.diaVencimento"
          [min]="1"
          [max]="28"
          placeholder="Dia do mês (1-28)"
          styleClass="full-width"
        />
      </div>

      <div class="form-group">
        <label>Data de Início</label>
        <input
          type="date"
          pInputText
          [(ngModel)]="novaAssinatura.dataInicio"
          styleClass="full-width"
        />
      </div>

      <div class="dialog-footer">
        <p-button
          label="Cancelar"
          icon="pi pi-times"
          (onClick)="fecharModal()"
          styleClass="p-button-text"
        />
        <p-button
          label="Criar"
          icon="pi pi-check"
          (onClick)="criarAssinatura()"
          [loading]="salvando()"
        />
      </div>
    </p-dialog>
